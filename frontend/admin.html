<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin - Event Dashboard</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <style>
    body { background: #f6f8fb; font-family: 'Segoe UI', sans-serif; }
    .container { max-width: 1200px; margin-top: 28px; }
    .panel { background: #fff; padding: 18px; border-radius: 12px; box-shadow: 0 8px 30px rgba(16,24,40,0.06); }
    .small-muted { font-size: .9rem; color: #6b7280; }
    .table-wrap { max-height: 420px; overflow:auto; border: 1px solid #eef2f7; border-radius: 8px; padding: 8px; background:#fff; }
  </style>
</head>
<body>
  <div class="container">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h3 class="mb-0">Admin — Event Dashboard</h3>
      <div>
        <a href="index.html" class="btn btn-outline-secondary me-2"><i class="bi bi-arrow-left"></i> Back to Dashboard</a>
        <button id="exportBtn" class="btn btn-outline-primary me-2"><i class="bi bi-download"></i> Export JSON</button>
        <button id="logoutBtn" class="btn btn-outline-danger"><i class="bi bi-box-arrow-right"></i> Logout</button>

        <label class="btn btn-primary mb-0">
          <i class="bi bi-upload"></i> Upload JSON
          <input id="adminUpload" type="file" accept=".json" hidden>
        </label>
      </div>
    </div>

    <div class="panel mb-3">
      <div class="row g-3">
        <div class="col-md-8">
          <div class="d-flex gap-2">
            <button id="btnAddParticipant" class="btn btn-success">Add Participant</button>
            <button id="btnAddEvent" class="btn btn-outline-primary">Add Event</button>
            <button id="btnAddStudent" class="btn btn-outline-secondary">Add Student</button>
            <button id="btnSaveLocal" class="btn btn-info ms-auto"><i class="bi bi-save"></i> Save to localStorage</button>
          </div>
          <div class="small-muted mt-2">Uploaded file: <span id="uploadedFileName">(none)</span></div>
        </div>
        <div class="col-md-4 text-end">
          <div class="small-muted">Current dataset sizes:</div>
          <div id="counts" class="fw-semibold mt-1">Participants: 0 • Events: 0 • Students: 0</div>
        </div>
      </div>
    </div>

    <div class="row g-3">
      <div class="col-md-6">
        <div class="panel">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h6 class="mb-0">Participants (All_Together_Data)</h6>
            <input id="searchParticipants" placeholder="Search name or id" class="form-control form-control-sm w-50" />
          </div>
          <div class="table-wrap mt-2">
            <table class="table table-sm table-hover mb-0">
              <thead class="table-light">
                <tr><th>Name</th><th>Student_ID</th><th>Event</th><th>Date</th><th>Status</th><th>Actions</th></tr>
              </thead>
              <tbody id="participantsTable"></tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="col-md-6">
        <div class="panel mb-3">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h6 class="mb-0">Events (Sheet1)</h6>
            <input id="searchEvents" placeholder="Search event name/id" class="form-control form-control-sm w-50" />
          </div>
          <div class="table-wrap mt-2">
            <table class="table table-sm table-hover mb-0">
              <thead class="table-light"><tr><th>Event Name</th><th>Date</th><th>Type</th><th>ID</th><th>Actions</th></tr></thead>
              <tbody id="eventsTable"></tbody>
            </table>
          </div>
        </div>

        <div class="panel">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h6 class="mb-0">Students (Sheet2)</h6>
            <input id="searchStudents" placeholder="Search student name/id" class="form-control form-control-sm w-50" />
          </div>
          <div class="table-wrap mt-2">
            <table class="table table-sm table-hover mb-0">
              <thead class="table-light"><tr><th>Student Name</th><th>ID</th><th>Dept</th><th>Gender</th><th>Actions</th></tr></thead>
              <tbody id="studentsTable"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal: Add/Edit Participant -->
    <div class="modal fade" id="modalParticipant" tabindex="-1">
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 id="participantModalTitle" class="modal-title">Add Participant</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <form id="participantForm">
              <div class="row g-2">
                <div class="col-md-6"><label class="form-label">Student_ID</label><input name="Student_ID" class="form-control" required></div>
                <div class="col-md-6"><label class="form-label">Student_Name</label><input name="Student_Name" class="form-control" required></div>
                <div class="col-md-6"><label class="form-label">Event_ID</label><input name="Event_ID" class="form-control" required></div>
                <div class="col-md-6"><label class="form-label">Event_Name</label><input name="Event_Name" class="form-control" required></div>
                <div class="col-md-6"><label class="form-label">Event_Date</label><input name="Event_Date" class="form-control" placeholder="YYYY-MM-DD"></div>
                <div class="col-md-6"><label class="form-label">Attendance_Status</label>
                  <select name="Attendance_Status" class="form-select">
                    <option>Attended</option><option>Absent</option><option>Excused</option>
                  </select>
                </div>
                <div class="col-12"><label class="form-label">Participation_Role</label><input name="Participation_Role" class="form-control"></div>
                <div class="col-12"><label class="form-label">Department</label><input name="Department" class="form-control"></div>
                <div class="col-12"><label class="form-label">Feedback</label><textarea name="Feedback" class="form-control"></textarea></div>
              </div>
              <input type="hidden" name="__mode" value="create">
              <div class="mt-3 text-end">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-primary">Save</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal: Add/Edit Event -->
    <div class="modal fade" id="modalEvent" tabindex="-1">
      <div class="modal-dialog modal-md modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 id="eventModalTitle" class="modal-title">Add Event</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <form id="eventForm">
              <div class="row g-2">
                <div class="col-md-12"><label class="form-label">Event_ID</label><input name="Event_ID" class="form-control" required></div>
                <div class="col-md-12"><label class="form-label">Event_Name</label><input name="Event_Name" class="form-control" required></div>
                <div class="col-md-6"><label class="form-label">Event_Date</label><input name="Event_Date" class="form-control"></div>
                <div class="col-md-6"><label class="form-label">Event_Type</label><input name="Event_Type" class="form-control"></div>
                <div class="col-12"><label class="form-label">Event_Location</label><input name="Event_Location" class="form-control"></div>
              </div>
              <input type="hidden" name="__mode" value="create">
              <div class="mt-3 text-end">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-primary">Save Event</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal: Add/Edit Student -->
    <div class="modal fade" id="modalStudent" tabindex="-1">
      <div class="modal-dialog modal-md modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 id="studentModalTitle" class="modal-title">Add Student</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <form id="studentForm">
              <div class="row g-2">
                <div class="col-md-12"><label class="form-label">Student_ID</label><input name="Student_ID" class="form-control" required></div>
                <div class="col-md-12"><label class="form-label">Student_Name</label><input name="Student_Name" class="form-control" required></div>
                <div class="col-md-6"><label class="form-label">Department</label><input name="Department" class="form-control"></div>
                <div class="col-md-6"><label class="form-label">Gender</label><input name="Gender" class="form-control"></div>
              </div>
              <input type="hidden" name="__mode" value="create">
              <div class="mt-3 text-end">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-primary">Save Student</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="admin.js"></script>
  <script>
  // Redirect if not logged in
  if (localStorage.getItem('isAdminLoggedIn') !== 'true') {
    window.location.href = 'admin-login.html';
  }
</script>

</body>
</html>
